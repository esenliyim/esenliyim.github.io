import{_ as e,o as t,c as o,e as n}from"./app.4a19620f.js";var a="/assets/gnome-shell-log-screenshot.c35a270b.png";const s={},i=n(`<p>I&#39;ve been developing and maintaining a Gnome Shell extension for some time. I don&#39;t have much love for the whole process.</p><p><a href="https://github.com/esenliyim/sp-tray" target="_blank" rel="noopener noreferrer">Sp-tray</a> is the extension I&#39;ve created. It doesn&#39;t do a whole lot, really. Uses DBus to get the metadata information from Spotify, and just displays it on the system tray or whatever it is called in Gnome. Though I&#39;ve given a lot of freedom in customizing <em>how</em> the information is displayed, which I&#39;m kinda proud of. That&#39;s not the point of this post though. The point is, creating a Gnome Shell extension is not fun.</p><p>The extensions are written in GJS, which, in Gnome&#39;s own words, &quot;is simply JavaScript bindings for the existing GNOME platform APIs&quot;. Essentially you write a piece of (mostly) regular ol&#39; JS code, put it in a certain directory on your system, Gnome Shell picks it up and executes it in its own JS runtime. No problem with that. That&#39;s how a lot of extension systems work, nothing unusual there. You write using a very common language for which documentation is plenty, and you&#39;re not using a weird dialect or flavor or anything. I mean it still has its quirks. Check out the following little snippet, which is just a few lines that import the relevant stuff into my code:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>GObject<span class="token punctuation">,</span> Gtk<span class="token punctuation">,</span> Gio<span class="token punctuation">}</span> <span class="token operator">=</span> imports<span class="token punctuation">.</span>gi<span class="token punctuation">;</span>
<span class="token keyword">const</span> Me <span class="token operator">=</span> imports<span class="token punctuation">.</span>misc<span class="token punctuation">.</span>extensionUtils<span class="token punctuation">.</span><span class="token function">getCurrentExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Gettext <span class="token operator">=</span> imports<span class="token punctuation">.</span>gettext<span class="token punctuation">;</span>

<span class="token keyword">const</span> ExtensionUtils <span class="token operator">=</span> imports<span class="token punctuation">.</span>misc<span class="token punctuation">.</span>extensionUtils<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You don&#39;t do any <code>require()</code>s or <code>import from</code>s. It does look and (mostly) work like regular ol&#39; JS, but it&#39;s still different enough to notice.</p><p>So what&#39;s the problem? Well there are a number of things that make the development process more annoying than it needs to be. Here are some of those, in no particular order.</p><h2 id="uncomfortable-debugging" tabindex="-1"><a class="header-anchor" href="#uncomfortable-debugging" aria-hidden="true">#</a> Uncomfortable debugging</h2><p>Debugging JS is not a good experience in general, but debugging GJS makes me want to shoot myself in the knee sometimes.</p><p>The most useful debugging tool you have is the <code>log()</code> function, which, as its name might suggest, logs something somewhere. Usually that &quot;somewhere&quot; is <code>journalctl</code>, which is a common dumping ground where a whole bunch of other things on the system will be dumping their own logs, so you&#39;ll have to search for your own logs in there. Even if you filter it to only show gnome-shell logs, you&#39;ll still see bajillions of lines of logs that are not relevant to you in the slightest. Often I find myself having to sorta &quot;decorate&quot; my logs with weird strings to make them easier to find in that jungle. Some days, some component of gnome-shell feels extra chatty and decides to flood <code>journalctl</code> with a ton of messages. Have fun finding your own particular needle in that haystack. I mean look at this:</p><p><img src="`+a+'" alt="gnome-shell log screenshot"></p><p>This is what the logs look like when the shell is started. A lot of lines dumped by a lot of things. Not groovy.</p><p>And who doesn&#39;t love the &quot;you forgot to handle a promise rejection in line 93&quot; kind of error messages, where line 93 is just the beginning of the function that eventually does something that eventually ends up doing something else that deals with promises somewhere down the line. Good luck finding where the unhandled rejection is in the file.</p><p>One thing that drove me up the wall while trying to figure out why my DBus code wasn&#39;t working was the fact that the <code>log()</code> function is entirely helpless in telling me what certain GLib variables look like. I call a certain function from that library, it returns an object, but I have no clue what the hell it looks like. Can&#39;t just log it because it&#39;s an object. Can&#39;t <code>JSON.stringify()</code> it, because the objects contained in that object don&#39;t have proper <code>toString()</code>s, and all you get is <code>{}</code>. I eventually figured it out, but the lack of proper debugging tools made it so much more difficult than it needed to be. This sort of things happen entirely way too often.</p><h2 id="questionable-documentation" tabindex="-1"><a class="header-anchor" href="#questionable-documentation" aria-hidden="true">#</a> Questionable documentation</h2><p>Back when I started writing the thing, which was a few years before I put it on Github and then on Gnome&#39;s extension website, finding any documentation about how any of this works was an art in and of itself. I had to read documentation written for Gnome&#39;s C and Python APIs, and then just make educated guesses to sorta &quot;translate&quot; those to GJS. Even when I did find things written for GJS, a lot of the time they were auto-generated texts that were even less descriptive than the functions&#39; signatures. Plenty of discussions on forums and platforms like stackoverflow about the sad, sad state of GJS documentation.</p><p>To be fair though, these days it&#39;s better. Not ideal, but better. I&#39;m having a much easier time getting my hands on useful documentation that doesn&#39;t require any &quot;if I was a GJS dev, how would I name this C function in Javascript&quot; kind of thinking from me.</p><h2 id="breaking-changes" tabindex="-1"><a class="header-anchor" href="#breaking-changes" aria-hidden="true">#</a> Breaking changes</h2><p>This is one of the bigger ones. Gnome&#39;s developers make breaking changes to their APIs very often. With every new update, you can see many of your installed extensions throwing up error messages saying &quot;this extension does not support current gnome-shell version&quot; or whatever. Very often it&#39;s just a matter of adding the current gnome-shell version number to the extension&#39;s metadata as a supported version without having to do anything else, but more often than not, things do break down completely and require a ton of dev time to fix.</p><p>For example, the piece of code that creates the settings menu for the extension is twice as long as it needs to be, because at some point we got upgraded to a new version of Gtk, which completely broke a lot of things that came before it. You either stopped supporting the older gnome-shell versions with your newer extension versions, or you wrote a lot extra code to implement a second strategy to create your menu.</p><p>I&#39;m fairly sure an update to gnome-shell some weeks ago made a breaking change to the DBus thingamajigs. Code that used to work perfectly fine for instantiating a DBus proxy suddenly started to return garbage values. Took me a while to find a solution <a href="#uncomfortable-debugging">because of the...</a> Though actually it could have also been Spotify&#39;s recent update that broke things. They did make some changes to their DBus interface around the same time. But reading GLib&#39;s changelogs, I think it wasn&#39;t Spotify&#39;s fault.</p><h2 id="no-ide-support" tabindex="-1"><a class="header-anchor" href="#no-ide-support" aria-hidden="true">#</a> No IDE support</h2><p>Code completion is life. Code completion reduces the number of mistakes you make. Code completion makes it easier to find the mistakes that you did make. Code completion helps you find the functions you&#39;re looking for. Code completion is everything.</p><p>There is no code completion of any kind while writing a Gnome Shell extension. None. You&#39;re on your own. It can be very, <em>very</em> frustrating. There are some projects on Github that are trying to remedy that, but from what I can tell they&#39;re not in a usable state. I imagine that things like the weird way of importing code seen at the beginning of this post have something to do with it.</p><h2 id="testing-is-non-existent" tabindex="-1"><a class="header-anchor" href="#testing-is-non-existent" aria-hidden="true">#</a> Testing is non-existent</h2><p>Usual test suites don&#39;t know what to do with your code, since it&#39;s structured in a way to be executed by gnome-shell. As far as I can tell, there are no test suites for GJS, so the only way to test your code is to load it up and see if it works. Which is of course not ideal. It is also quite annoying if you&#39;re developing on Xorg, and completely and utterly impractical if you&#39;re developing on Wayland. Because you see, extensions are loaded when gnome-shell starts. The only way to make your changes take effect is to restart the entire gnome-shell. On Xorg it&#39;s mostly a minor inconvenience that freezes your PC for a couple of seconds, but on Wayland it requires restarting your whole user session, because Gnome doesn&#39;t support restarting just the shell under Wayland. And that is, of course, quite far from being just a minor inconvenience. That is straight up unacceptable. Imagine having to log out and log back in to your user account just because you made a small typo somewhere. Just... no. There seem to be some workarounds to this by running a nested Wayland session under X, but... meh.</p><h2 id="what-makes-it-all-even-weirder" tabindex="-1"><a class="header-anchor" href="#what-makes-it-all-even-weirder" aria-hidden="true">#</a> What makes it all even weirder</h2><p>Gnome&#39;s developers are... <em>peculiar</em>. They have peculiar ideas as to what makes a DE usable, and they have a peculiar <em>vision</em> for their product. They aren&#39;t making a conventional desktop environment to be used on a PC, their DE is geared towards laptops and their touchpad gestures. It&#39;s proven to be a rather controversial position. Not very surprising, considering Gnome is the most common DE in the Linux ecosystem, where I imagine a very large chunk of users are on PCs. Also, still fresh are the traumatic memories of Windows 8, which also appeared to follow this same path to some degree.</p><p>Anyway, the &quot;vanilla&quot; Gnome is some pretty bare-bones stuff that lacks a ton of features and functionality that the average PC user has come to expect from their computer. Those are made available via extensions. Like, if you want to have a usable desktop in your <em>desktop</em> environment, you have to enable an extension that lets you put items on your desktop. Want your taskbar to show what windows you currently have open? That&#39;s an extension. Without those the PC feels like a tablet, which is not unintentional, as explained above.</p><p>In my opinion at least, Gnome is completely worthless without the extensions to enable some of those features. I don&#39;t see Gnome Shell extensions as flair, or neat additions to my system. To me the extensions are an absolute necessity to make Gnome usable as a desktop environment. I simply would not use Gnome without them, not even begrudgingly. Which is why I find it very odd that creating them has been such a pain in the ass for such a long time. If you&#39;re so heavily rely on extensions, why not make their development easier?</p><p>Well, I&#39;m rambling again. I hope you folks enjoyed yourselves. Catch you later on down the trail.</p><p><a href="https://www.manufactum.com/garden-gnome-swing-a33585/" target="_blank" rel="noopener noreferrer">Header image source</a></p>',31),r=[i];function h(l,u){return t(),o("div",null,r)}var c=e(s,[["render",h],["__file","creating-gnome-shell-extension.html.vue"]]);export{c as default};
